<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <title>Moja ToDo AplikÃ¡cia</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/confirmDate/confirmDate.css">

    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#3498db">

</head>

<body>

    <div class="container">
        <h1>ğŸ“ Moje Ãºlohy</h1>

        <div class="theme-toggle">
            <label for="darkmode-toggle">
                ğŸŒ™ TmavÃ½ reÅ¾im
                <input type="checkbox" id="darkmode-toggle">
            </label>
        </div>
        
        <form method="GET" action="/" class="filter-form">
            <label for="filter-select">FiltrovaÅ¥:</label>
            <select id="filter-select" name="filter">
                <option value="all" {% if filter == 'all' %}selected{% endif %}>VÅ¡etky</option>
                <option value="done" {% if filter == 'done' %}selected{% endif %}>âœ… SplnenÃ©</option>
                <option value="not_done" {% if filter == 'not_done' %}selected{% endif %}>ğŸ•“ NesplnenÃ©</option>
                <option value="high" {% if filter == 'high' %}selected{% endif %}>ğŸ”´ VysokÃ¡ priorita</option>
                <option value="medium" {% if filter == 'medium' %}selected{% endif %}>ğŸŸ¡ StrednÃ¡ priorita</option>
                <option value="low" {% if filter == 'low' %}selected{% endif %}>ğŸ”µ NÃ­zka priorita</option>
            </select>

            <label for="sort-select">TriediÅ¥ podÄ¾a:</label>
            <select id="sort-select" name="sort">
                <option value="auto" {% if sort == 'auto'  %}selected{% endif %}>Automaticky (termÃ­n + priorita)</option>
                <option value="manual" {% if sort == 'manual' %}selected{% endif %}>ManuÃ¡lne (podÄ¾a zadanie)</option>
            </select>

            <button type="submit">PouÅ¾iÅ¥</button>
        </form>

        <form method="POST" action="/add">
            <input type="text" name="task" placeholder="Zadaj Ãºlohu" required>
            <input type="text" id="add-due-date" name="due_date" placeholder="Vyber DÃ¡tum a Äas" required>

            <select name="priority" required>
                <option value="low">ğŸ”µ NÃ­zka</option>
                <option value="medium">ğŸŸ¡ StrednÃ¡</option>
                <option value="high">ğŸ”´ VysokÃ¡</option>
            </select>

            <button type="submit">PridaÅ¥</button>
    
        </form>

            {% if tasks_overdue %}
                <h2 style="color: red;">â— Po termÃ­ne</h2>
                <ul>
                    {% for task in tasks_overdue %}
                        {% include "task_item.html" %}
                    {% endfor %}
                </ul>
            {% endif %}

            {% if tasks_today %}
                <h2 style="color: #2c3e50;">ğŸ“… Dnes</h2>
                <ul>
                    {% for task in tasks_today %}
                        {% include "task_item.html" %}
                    {% endfor %}
                </ul>
            {% endif %}

            {% if tasks_tomorrow %}
                <h2 style="color: #2c3e50;">ğŸ“† Zajtra</h2>
                <ul>
                    {% for task in tasks_tomorrow %}
                        {% include "task_item.html" %}
                    {% endfor %}
                </ul>
            {% endif %}

            {% if tasks_later %}
                <h2 style="color: #2c3e50;">ğŸ“‚ NeskÃ´r</h2>
                <ul>
                    {% for task in tasks_later %}
                        {% include "task_item.html" %}
                    {% endfor %}
                </ul>
            {% endif %}

    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/confirmDate/confirmDate.min.js"></script>

    <script>
        flatpickr("#add-due-date", {
                 enableTime: true,
            dateFormat: "d.m.Y H:i",
            time_24hr: true,
            allowInput: true,
            locale: {
                firstDayOfWeek: 1
            },
            plugins: [
                new confirmDatePlugin({
                    confirmText: "OK",
                    showAlways: false,
                    theme: "light"
                })
            ]
        });
    </script>

<script>
    const themeToggle = document.getElementById("darkmode-toggle");

    if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark-mode");
        themeToggle.checked = true;
    }

    themeToggle.addEventListener("change", () => {
        const isDark = themeToggle.checked;

        if (isDark) {
            document.body.classList.add("dark-mode");
            localStorage.setItem("theme", "dark");
        } else {
            document.body.classList.remove("dark-mode");
            localStorage.setItem("theme", "light");
        }      
    });
</script>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js')
      .then(function(registration) {
        console.log('âœ… ServiceWorker registrovanÃ½:', registration);
      }).catch(function(error) {
        console.error('âŒ Chyba pri registrÃ¡cii ServiceWorker:', error);
      });
  }
</script>

</body>
</html>